{
  "_id": "rule-4-set-reminder-child_v10_date",
  "name": "rule #4: Set reminder [child_v10_date]",
  "actions": [
    {
      "displayName": "scheduler.unscheduleJobs",
      "channelName": "scheduler",
      "moduleName": "motech-scheduler",
      "moduleVersion": "0.21.0.SNAPSHOT",
      "serviceInterface": "org.motechproject.scheduler.MotechSchedulerActionProxyService",
      "serviceMethod": "unscheduleJobs",
      "values": {
        "subject": "org.worldvision.sierraleone.child-visit.{{ad.3980fa00249eb3bf73e200bd85122e72.CaseInfo#1.fieldValues.child_v10_date?datetime(yyyy-MM-dd HH:mm Z)}}"
      }
    },
    {
      "displayName": "scheduler.scheduleRunOnceJob",
      "channelName": "scheduler",
      "moduleName": "motech-scheduler",
      "moduleVersion": "0.21.0.SNAPSHOT",
      "serviceInterface": "org.motechproject.scheduler.MotechSchedulerActionProxyService",
      "serviceMethod": "scheduleRunOnceJob",
      "values": {
        "startDate": "{{ad.3980fa00249eb3bf73e200bd85122e72.CaseInfo#1.fieldValues.child_v10_date?plusDays(1)?datetime(yyyy-MM-dd HH:mm Z)}}",
        "motechEventParameters": "child_case_id:{{ad.3980fa00249eb3bf73e200bd85122e72.CommcareForm#0.form.elements.case.attributes.case_id}}\nmother_case_id:{{ad.3980fa00249eb3bf73e200bd85122e72.CaseInfo#1.indices.parent.case_id}}",
        "motechEventSubject": "org.worldvision.sierraleone.child-visit.{{ad.3980fa00249eb3bf73e200bd85122e72.CaseInfo#1.fieldValues.child_v10_date?datetime(yyyy-MM-dd HH:mm Z)}}"
      }
    }
  ],
  "trigger": {
    "displayName": "commcare.formstub",
    "channelName": "commcare",
    "moduleName": "motech-commcare-api",
    "moduleVersion": "0.21.0.SNAPSHOT",
    "subject": "org.motechproject.commcare.api.formstub"
  },
  "enabled": true,
  "taskConfig": {
    "steps": [
      {
        "@type": "DataSource",
        "order": 0,
        "providerName": "commcare.name",
        "providerId": "3980fa00249eb3bf73e200bd85122e72",
        "objectId": 0,
        "type": "CommcareForm",
        "name": "id",
        "lookup": [
          {
            "field": "id",
            "value": "{{trigger.formId}}"
          }
        ],
        "failIfDataNotFound": true
      },
      {
        "@type": "FilterSet",
        "order": 1,
        "filters": [
          {
            "displayName": "Form name (Form#0 (Commcare))",
            "key": "ad.3980fa00249eb3bf73e200bd85122e72.CommcareForm#0.form.attributes.name",
            "type": "UNICODE",
            "negationOperator": true,
            "operator": "task.equals",
            "expression": "Child Visit"
          }
        ]
      },
      {
        "@type": "DataSource",
        "order": 2,
        "providerName": "commcare.name",
        "providerId": "3980fa00249eb3bf73e200bd85122e72",
        "objectId": 1,
        "type": "CaseInfo",
        "name": "id",
        "lookup": [
          {
            "field": "id",
            "value": "{{ad.3980fa00249eb3bf73e200bd85122e72.CommcareForm#0.form.elements.case.attributes.case_id}}"
          }
        ],
        "failIfDataNotFound": true
      },
      {
        "@type": "FilterSet",
        "order": 3,
        "filters": [
          {
            "displayName": "Case type (Form#1 (Commcare))",
            "key": "ad.3980fa00249eb3bf73e200bd85122e72.CaseInfo#1.indices.parent.case_type",
            "type": "UNICODE",
            "negationOperator": true,
            "operator": "task.equals",
            "expression": "mother"
          },
          {
            "displayName": "child_v10_date (Form#1 (Commcare))",
            "key": "ad.3980fa00249eb3bf73e200bd85122e72.CaseInfo#1.fieldValues.child_v10_date",
            "type": "DATE",
            "negationOperator": true,
            "operator": "task.afterNow"
          }
        ]
      }
    ]
  }
}
